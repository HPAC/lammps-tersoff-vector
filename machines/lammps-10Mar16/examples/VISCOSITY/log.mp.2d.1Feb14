LAMMPS (1 Feb 2014)
# sample LAMMPS input script for viscosity of 2d LJ liquid
# Muller-Plathe via fix viscosity

# settings

variable	x equal 20
variable	y equal 20

variable	rho equal 0.6
variable        t equal 1.0
variable	rc equal 2.5

# problem setup

units		lj
dimension	2
atom_style	atomic
neigh_modify	delay 0 every 1

lattice         sq2 ${rho}
lattice         sq2 0.6
Lattice spacing in x,y,z = 1.82574 1.82574 1.82574
region          simbox block 0 $x 0 $y -0.1 0.1
region          simbox block 0 20 0 $y -0.1 0.1
region          simbox block 0 20 0 20 -0.1 0.1
create_box      1 simbox
Created orthogonal box = (0 0 -0.182574) to (36.5148 36.5148 0.182574)
  1 by 1 by 1 MPI processor grid
create_atoms    1 box
Created 800 atoms

pair_style      lj/cut ${rc}
pair_style      lj/cut 2.5
pair_coeff      * * 1 1

mass            * 1.0
velocity        all create $t 97287
velocity        all create 1 97287

fix             1 all nve
fix	        2 all langevin $t $t 0.1 498094
fix	        2 all langevin 1 $t 0.1 498094
fix	        2 all langevin 1 1 0.1 498094
fix	        3 all enforce2d

# equilibration run

thermo          1000
run	        5000
Memory usage per processor = 2.06394 Mbytes
Step Temp E_pair E_mol TotEng Press 
       0            1     -1.56492            0     -0.56617    -1.535262 
    1000   0.95906897    -1.571142            0  -0.61327189   0.82593948 
    2000    1.0164992   -1.6006146            0  -0.58538603   0.88642098 
    3000    1.0429232   -1.5801639            0  -0.53854441     1.157286 
    4000    1.0955206   -1.6156387            0  -0.52148756   0.94410568 
    5000   0.94117593   -1.6155055            0  -0.67550602   0.79354126 
Loop time of 0.858331 on 1 procs for 5000 steps with 800 atoms

Pair  time (%) = 0.46184 (53.8067)
Neigh time (%) = 0.102345 (11.9237)
Comm  time (%) = 0.0174992 (2.03875)
Outpt time (%) = 5.10216e-05 (0.00594428)
Other time (%) = 0.276596 (32.2248)

Nlocal:    800 ave 800 max 800 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    256 ave 256 max 256 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    5583 ave 5583 max 5583 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 5583
Ave neighs/atom = 6.97875
Neighbor list builds = 551
Dangerous builds = 0

unfix		2

# turn on Muller-Plathe driving force and equilibrate some more

velocity	all scale $t
velocity	all scale 1

fix		4 all viscosity 100 x y 20
fix		5 all ave/spatial 20 50 1000 y center 0.05 vx 		  units reduced file profile.mp.2d

# equilibration run

variable	dVx equal f_5[11][3]-f_5[1][3]

thermo          1000
thermo_style	custom step temp epair etotal press f_4 v_dVx
run		20000
WARNING: Fix viscosity comes before fix ave/spatial (../fix_viscosity.cpp:129)
Memory usage per processor = 2.06486 Mbytes
Step Temp E_pair TotEng Press 4 dVx 
    5000            1   -1.6155055  -0.61675549   0.82879159            0            0 
    6000   0.98687509   -1.6019556   -0.6163141   0.81812957   -40.544054   0.48107738 
    7000   0.99812635     -1.61413   -0.6172513   0.88049928   -72.131982   0.83982485 
    8000   0.99508548   -1.6108778  -0.61703621    1.0010053   -105.28099   0.80829601 
    9000   0.94912106    -1.564488  -0.61655333    1.0184324   -141.59349   0.94800981 
   10000   0.99258056   -1.6078678  -0.61652794   0.94564321   -171.73806    1.1494339 
   11000    1.0159215   -1.6317434  -0.61709181   0.92235272   -199.00526    1.1830449 
   12000    1.0126611   -1.6277928  -0.61639754    0.7688915   -227.93583    1.2636885 
   13000    1.0122947   -1.6285623  -0.61753296   0.88334788   -258.44565     1.217365 
   14000    1.0175562   -1.6335087  -0.61722444   0.84125493   -282.91095    1.3683789 
   15000   0.97750561   -1.5930807  -0.61679697    1.1287326   -313.39632    1.2230677 
   16000   0.98242425   -1.5980008  -0.61680456   0.91325299   -339.83912    1.2882183 
   17000     1.008242   -1.6242405  -0.61725887   0.87284759   -365.79175    1.4803679 
   18000   0.99455824    -1.610205  -0.61688999   0.80190574   -391.57365    1.3145093 
   19000    1.0075504   -1.6245154  -0.61822443    1.1173911   -419.47456    1.2444018 
   20000    1.0169723   -1.6334224   -0.6177213    0.8584711   -448.67177    1.2101637 
   21000   0.98967224   -1.6055692  -0.61713404   0.80442505    -476.9284    1.4306147 
   22000   0.97813764   -1.5935756  -0.61666068   0.99668957   -501.83621    1.5824584 
   23000   0.98098823   -1.5963749  -0.61661287    1.1169304   -526.25935    1.4837827 
   24000    1.0002987   -1.6158635  -0.61681517   0.92338935   -554.31346    1.3408732 
   25000   0.99862734   -1.6139679  -0.61658884   0.87430158   -582.99367    1.2441321 
Loop time of 2.75452 on 1 procs for 20000 steps with 800 atoms

Pair  time (%) = 1.86056 (67.5458)
Neigh time (%) = 0.440814 (16.0033)
Comm  time (%) = 0.0745592 (2.7068)
Outpt time (%) = 0.000242233 (0.00879403)
Other time (%) = 0.378341 (13.7353)

Nlocal:    800 ave 800 max 800 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    253 ave 253 max 253 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    5598 ave 5598 max 5598 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 5598
Ave neighs/atom = 6.9975
Neighbor list builds = 2354
Dangerous builds = 0

# data gathering run
# reset fix viscosity to zero flux accumulation

unfix		4
fix		4 all viscosity 100 x y 20

variable	visc equal -(f_4/(2*(step*0.005-125)*lx+1.0e-10))/(v_dVx/(ly/2))
fix		vave all ave/time 1000 1 1000 v_visc ave running start 26000

thermo_style	custom step temp f_4 v_dVx v_visc f_vave

# only need to run for 10000 steps to make a good 100-frame movie

#dump	        1 all custom 100 dump.mp.2d id type x y z vx

#dump		1 all image 100 image.*.jpg vx type zoom 1.6 adiam 1.2
#dump_modify	1 pad 5 amap -0.7 0.7 ca 0.0 2 min blue max red

run	        50000
Memory usage per processor = 2.103 Mbytes
Step Temp 4 dVx visc vave 
   25000   0.99862734            0    1.2441321            0            0 
   26000     1.006121   -29.834985    1.0067717    1.4817155   0.74085773 
   27000     1.000685    -57.28656    1.3703643    1.0450973   0.84227093 
   28000    1.0119383   -82.689969    1.5329066    0.8990542   0.85646674 
   29000     1.005591   -111.52398    1.3679394    1.0190874   0.88899088 
   30000    0.9780793   -132.09122    1.4693711   0.89896428   0.89065311 
   31000   0.98954223   -160.54318    1.4144949   0.94582162   0.89853433 
   32000   0.98452695   -186.95511    1.3592447    0.9824527   0.90902412 
   33000    1.0137305   -216.75823    1.1667402    1.1611316   0.93703607 
   34000     1.004699   -243.79453    1.3554751   0.99921723   0.94325418 
   35000   0.99279233   -272.99034    1.4414031   0.94696042   0.94359111 
   36000   0.98601686   -296.44885    1.2290954    1.0963305    0.9563194 
   37000   0.99960393   -327.77258    1.2754827    1.0707469   0.96512151 
   38000    1.0232092   -354.20371     1.471032   0.92609943   0.96233422 
   39000    1.0220897   -380.33308    1.4729611   0.92217809   0.95965714 
   40000     1.003192   -409.96551    1.1486002     1.189754    0.9740382 
   41000    1.0339239    -441.2471    1.2766924    1.0800543   0.98027444 
   42000    0.9707256   -469.29726     1.298219    1.0632151   0.98488226 
   43000     1.012508   -498.86351    1.3419554    1.0326215   0.98739485 
   44000    1.0104362   -528.29202    1.2868256    1.0803656   0.99204339 
   45000    1.0031694   -554.14027    1.3431643    1.0314082    0.9939179 
   46000   0.98757964   -582.17026    1.3410473    1.0336098   0.99572208 
   47000    1.0329913    -612.8052    1.0693478    1.3024192    1.0090567 
   48000    1.0040957      -640.38    1.3648753    1.0199689    1.0095114 
   49000    1.0213711   -667.39045    1.3779353    1.0090436    1.0094927 
   50000    1.0028765   -693.00523     1.353182    1.0242602    1.0100607 
   51000    1.0456929   -723.75516    1.3013825    1.0695063    1.0122624 
   52000   0.98661701    -753.9132    1.1752559    1.1879417    1.0185366 
   53000    1.0067127   -785.13019    1.0304513    1.3605866    1.0303315 
   54000    1.0049746   -814.24066    1.3688029    1.0256138    1.0301742 
   55000   0.99145341   -839.02294    1.5370182   0.90979505     1.026291 
   56000   0.99330997   -866.91329    1.4290157    0.9784688    1.0247966 
   57000   0.97297071   -891.05513    1.3697724     1.016427    1.0245429 
   58000    1.0055628   -915.32616    1.7035058   0.81411979     1.018354 
   59000   0.97447836   -940.88078    1.4544592   0.95131452    1.0164386 
   60000   0.97786144   -970.22273    1.3938314   0.99440472    1.0158266 
   61000    1.0069781   -996.52024    1.2925348    1.0708074    1.0173125 
   62000   0.99860063   -1024.4668    1.3677043    1.0122178    1.0171785 
   63000    1.0160002   -1052.8951    1.2909807    1.0731286    1.0186131 
   64000    1.0075017   -1081.0833    1.4389443   0.96320906     1.017228 
   65000    1.0128103   -1110.5507    1.3712762    1.0123332    1.0171086 
   66000   0.99788687    -1138.143    1.1744686    1.1817934    1.0210297 
   67000   0.99340723   -1165.3818    1.2141024    1.1427037    1.0238593 
   68000   0.99891442   -1194.3011    1.1838074    1.1730981    1.0272511 
   69000     1.010782   -1222.8307    1.2890796    1.0779631     1.028378 
   70000    1.0084059   -1254.3924    1.3961366   0.99830441    1.0277242 
   71000   0.98457274   -1285.1565    1.3228471     1.055987    1.0283256 
   72000   0.98997963   -1309.8959    1.3420552    1.0383376    1.0285342 
   73000   0.99661456   -1338.2166     1.114478    1.2507878    1.0330699 
   74000   0.98823959   -1367.5535    1.1382114    1.2260136    1.0369288 
   75000   0.99114295   -1396.3043     1.181084    1.1822226    1.0397777 
Loop time of 6.87975 on 1 procs for 50000 steps with 800 atoms

Pair  time (%) = 4.64786 (67.5585)
Neigh time (%) = 1.09953 (15.9821)
Comm  time (%) = 0.184543 (2.68241)
Outpt time (%) = 0.000693083 (0.0100742)
Other time (%) = 0.947126 (13.7669)

Nlocal:    800 ave 800 max 800 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    257 ave 257 max 257 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    5559 ave 5559 max 5559 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 5559
Ave neighs/atom = 6.94875
Neighbor list builds = 5873
Dangerous builds = 0
